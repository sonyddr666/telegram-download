services:
  # Self-hosted Telegram Bot API Server (limite 2GB)
  telegram-bot-api:
    build:
      context: ./telegram-bot-api
      dockerfile: Dockerfile
    container_name: telegram-bot-api
    environment:
      - API_ID=${API_ID}
      - API_HASH=${API_HASH}
    ports:
      - "8081:8081"
    volumes:
      - telegram-api-data:/var/lib/telegram-bot-api
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8081/"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Bot de download de v√≠deos
  telegram-bot:
    build: .
    container_name: video-downloader-telegram-bot
    volumes:
      - ./downloads:/downloads
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - DOWNLOADS_DIR=/downloads
      - BOT_API_URL=http://telegram-bot-api:8081/bot
    depends_on:
      telegram-bot-api:
        condition: service_healthy
    restart: unless-stopped

volumes:
  telegram-api-data:
