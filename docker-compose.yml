services:
  # Self-hosted Telegram Bot API Server (limite 2GB) - IMAGEM PRÉ-COMPILADA
  telegram-bot-api:
    image: aiogram/telegram-bot-api:latest
    container_name: telegram-bot-api
    environment:
      TELEGRAM_API_ID: "${API_ID}"
      TELEGRAM_API_HASH: "${API_HASH}"
      TELEGRAM_LOCAL: "1"
    ports:
      - "8081:8081"
    volumes:
      - telegram-api-data:/var/lib/telegram-bot-api
    restart: unless-stopped

  # Bot de download de vídeos
  telegram-bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: video-downloader-telegram-bot
    volumes:
      - ./downloads:/downloads
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - DOWNLOADS_DIR=/downloads
      - BOT_API_URL=http://telegram-bot-api:8081/bot
    depends_on:
      - telegram-bot-api
    restart: unless-stopped

volumes:
  telegram-api-data:
